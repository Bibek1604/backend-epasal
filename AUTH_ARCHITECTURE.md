# ğŸ—ï¸ Authentication System Architecture

## System Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EPASALEY BACKEND                          â”‚
â”‚                    Authentication System v1.0                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Frontend)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  1. LOGIN PHASE                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Admin enters:                                             â”‚    â”‚
â”‚  â”‚ â€¢ Admin ID: "ADMIN001"                                   â”‚    â”‚
â”‚  â”‚ â€¢ Password: "Admin@123"                                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ POST /api/v1/auth/login                                 â”‚    â”‚
â”‚  â”‚ {                                                        â”‚    â”‚
â”‚  â”‚   "adminId": "ADMIN001",                                â”‚    â”‚
â”‚  â”‚   "password": "Admin@123"                               â”‚    â”‚
â”‚  â”‚ }                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND SERVER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  2. LOGIN PROCESSING (auth.controller.ts)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Validate input (adminId, password)                    â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 2. Find admin in MongoDB (Admin.findOne)                 â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 3. Compare password (bcryptjs.compare)                   â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 4. If valid:                                             â”‚    â”‚
â”‚  â”‚    â€¢ Update lastLogin timestamp                          â”‚    â”‚
â”‚  â”‚    â€¢ Generate JWT token (7-day expiry)                   â”‚    â”‚
â”‚  â”‚    â€¢ Return token + admin info                           â”‚    â”‚
â”‚  â”‚ 5. If invalid:                                           â”‚    â”‚
â”‚  â”‚    â€¢ Return 401 Unauthorized error                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                          â”‚
â”‚  Token Payload:       â”‚                                          â”‚
â”‚  {                    â”‚                                          â”‚
â”‚    id: "507f...",     â”‚                                          â”‚
â”‚    email: "...",      â”‚                                          â”‚
â”‚    role: "admin",     â”‚                                          â”‚
â”‚    iat: 1701...,      â”‚                                          â”‚
â”‚    exp: 1702...       â”‚                                          â”‚
â”‚  }                    â”‚                                          â”‚
â”‚                       â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPONSE TO CLIENT                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  HTTP 200 OK                                                       â”‚
â”‚  {                                                                 â”‚
â”‚    "success": true,                                               â”‚
â”‚    "message": "Login successful",                                 â”‚
â”‚    "data": {                                                       â”‚
â”‚      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",          â”‚
â”‚      "admin": {                                                    â”‚
â”‚        "id": "507f1f77bcf86cd799439011",                          â”‚
â”‚        "adminId": "ADMIN001",                                     â”‚
â”‚        "name": "Admin User",                                      â”‚
â”‚        "email": "admin@epasaley.com",                             â”‚
â”‚        "role": "super_admin"                                      â”‚
â”‚      }                                                             â”‚
â”‚    }                                                               â”‚
â”‚  }                                                                 â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT STORES TOKEN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  localStorage.setItem("authToken", token)                         â”‚
â”‚  OR                                                                â”‚
â”‚  sessionStorage.setItem("authToken", token)                       â”‚
â”‚  OR                                                                â”‚
â”‚  Store in state/context/Redux                                     â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   3. PROTECTED OPERATIONS PHASE   â”‚
        â”‚                                   â”‚
        â”‚  Admin wants to:                  â”‚
        â”‚  â€¢ Create category                â”‚
        â”‚  â€¢ Update product                 â”‚
        â”‚  â€¢ Delete coupon                  â”‚
        â”‚  â€¢ etc.                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                CLIENT MAKES PROTECTED REQUEST                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  const token = localStorage.getItem("authToken")                  â”‚
â”‚                                                                    â”‚
â”‚  POST /api/v1/categories                                          â”‚
â”‚  Headers: {                                                        â”‚
â”‚    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIs...",            â”‚
â”‚    "Content-Type": "application/json"                             â”‚
â”‚  }                                                                 â”‚
â”‚  Body: {                                                           â”‚
â”‚    "name": "Electronics",                                         â”‚
â”‚    "description": "Electronic devices"                            â”‚
â”‚  }                                                                 â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND VERIFICATION (Middleware)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  authenticate() middleware (authMiddleware.ts)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Extract token from Authorization header              â”‚    â”‚
â”‚  â”‚    "Bearer eyJhbGciOiJIUzI1NiIs..." â†’ token            â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 2. Call verifyToken(token) (tokenGenerator.ts)          â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 3. Verify signature with JWT_SECRET                     â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 4. Check expiration                                      â”‚    â”‚
â”‚  â”‚    â†“                                                      â”‚    â”‚
â”‚  â”‚ 5. If valid:                                             â”‚    â”‚
â”‚  â”‚    â€¢ Decode token                                        â”‚    â”‚
â”‚  â”‚    â€¢ Attach to req.user                                  â”‚    â”‚
â”‚  â”‚    â€¢ Check admin role if required                        â”‚    â”‚
â”‚  â”‚    â€¢ Allow request to proceed                            â”‚    â”‚
â”‚  â”‚ 6. If invalid/expired:                                   â”‚    â”‚
â”‚  â”‚    â€¢ Return 401 Unauthorized                             â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚              â”‚
         âœ… VALID â”‚              â”‚ âŒ INVALID
                 â”‚              â”‚
                 â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AUTHORIZED  â”‚   â”‚ 401 ERROR    â”‚
        â”‚ Proceed     â”‚   â”‚ Unauthorized â”‚
        â”‚ with route  â”‚   â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Execute Controller     â”‚
    â”‚ (categoryController)   â”‚
    â”‚ â€¢ Validate data       â”‚
    â”‚ â€¢ Process business    â”‚
    â”‚ â€¢ Update database     â”‚
    â”‚ â€¢ Return response     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ HTTP 201 Created       â”‚
    â”‚ {                      â”‚
    â”‚   "success": true,     â”‚
    â”‚   "data": {            â”‚
    â”‚     "_id": "...",      â”‚
    â”‚     "name": "....",    â”‚
    â”‚     ...                â”‚
    â”‚   }                    â”‚
    â”‚ }                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONGODB DATABASE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  admins collection                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ _id: ObjectId("507f1f77bcf86cd799439011")              â”‚    â”‚
â”‚  â”‚ adminId: "ADMIN001"                                     â”‚    â”‚
â”‚  â”‚ email: "admin@epasaley.com"                             â”‚    â”‚
â”‚  â”‚ password: "$2a$10$..." (hashed with bcryptjs)           â”‚    â”‚
â”‚  â”‚ name: "Admin User"                                      â”‚    â”‚
â”‚  â”‚ role: "super_admin"                                     â”‚    â”‚
â”‚  â”‚ isActive: true                                          â”‚    â”‚
â”‚  â”‚ lastLogin: Date(2025-11-28T10:30:00Z)                  â”‚    â”‚
â”‚  â”‚ createdAt: Date(2025-11-20T08:00:00Z)                  â”‚    â”‚
â”‚  â”‚ updatedAt: Date(2025-11-28T10:30:00Z)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  When login() called:                                            â”‚
â”‚  1. Find admin by adminId                                        â”‚
â”‚  2. Compare plaintext password with hashed password              â”‚
â”‚  3. If match â†’ generate token                                    â”‚
â”‚  4. Update lastLogin                                             â”‚
â”‚  5. Return token                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure & Relationships

```
src/
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ Admin.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â€¢ IAdmin interface                â”‚
â”‚       â€¢ adminId: string                 â”‚
â”‚       â€¢ email: string                   â”‚
â”‚       â€¢ password: string (hashed)       â”‚
â”‚       â€¢ comparePassword() method         â”‚
â”‚                                         â”‚
â”œâ”€â”€ controllers/                          â”‚
â”‚   â””â”€â”€ auth.controller.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â€¢ login() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Uses Admin model â”‚
â”‚       â€¢ getProfile()                    â”‚                  â”‚
â”‚       â€¢ register()                      â”‚                  â”‚
â”‚       â€¢ updatePassword()                â”‚                  â”‚
â”‚       â€¢ logout()                        â”‚                  â”‚
â”‚                                         â”‚                  â”‚
â”œâ”€â”€ routes/                               â”‚                  â”‚
â”‚   â”œâ”€â”€ auth.routes.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â€¢ POST /login                     â”‚ Uses auth         â”‚
â”‚   â”‚   â€¢ GET /profile                    â”‚ controller        â”‚
â”‚   â”‚   â€¢ PUT /password                   â”‚                  â”‚
â”‚   â”‚   â€¢ POST /logout                    â”‚                  â”‚
â”‚   â”‚   â€¢ POST /register                  â”‚                  â”‚
â”‚   â”‚                                     â”‚                  â”‚
â”‚   â””â”€â”€ index.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â€¢ Mounts auth routes              | Mounts auth.routes
â”‚       â€¢ Mounts other routes             |
â”‚       â€¢ "/auth" prefix                  â”‚
â”‚                                         â–¼
â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ authMiddleware.ts
â”‚   â”‚   â€¢ authenticate() - Verify JWT token
â”‚   â”‚   â€¢ Used on protected routes
â”‚   â”‚
â”‚   â”œâ”€â”€ asyncHandler.ts (existing)
â”‚   â”‚   â€¢ Wraps async route handlers
â”‚   â”‚   â€¢ Catches errors
â”‚   â”‚
â”‚   â””â”€â”€ errorHandler.ts (existing)
â”‚       â€¢ Global error handling
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ tokenGenerator.ts (enhanced)
â”‚   â”‚   â€¢ generateToken()
â”‚   â”‚   â€¢ verifyToken()
â”‚   â”‚   â€¢ Uses JWT_SECRET / JWT_ADMIN_SECRET
â”‚   â”‚
â”‚   â””â”€â”€ errors.ts (existing)
â”‚       â€¢ UnauthorizedError (401)
â”‚       â€¢ ForbiddenError (403)
â”‚       â€¢ BadRequestError (400)
â”‚
â””â”€â”€ app.ts
    â€¢ Express app setup
    â€¢ Middleware registration
    â€¢ Route mounting

setupAdmin.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â€¢ Creates initial admin accounts                      â”‚
    â€¢ Run: npm run setup-admin                           â”‚
    â€¢ Uses Admin model                                    â”‚
    â”‚                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Token Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT TOKEN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.               â”‚
â”‚  eyJpZCI6IjUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMSIsI... â”‚
â”‚  SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c       â”‚
â”‚                                                          â”‚
â”‚  â”œâ”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚  {                                                   â”‚
â”‚  â”‚    "alg": "HS256",                                  â”‚
â”‚  â”‚    "typ": "JWT"                                     â”‚
â”‚  â”‚  }                                                   â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ PAYLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚  {                                                   â”‚
â”‚  â”‚    "id": "507f1f77bcf86cd799439011",               â”‚
â”‚  â”‚    "email": "admin@epasaley.com",                  â”‚
â”‚  â”‚    "role": "admin",                                â”‚
â”‚  â”‚    "iat": 1701158400,      â† Issued at             â”‚
â”‚  â”‚    "exp": 1701763200       â† Expires (7 days)      â”‚
â”‚  â”‚  }                                                   â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ SIGNATURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚     HMACSHA256(base64(header) + "." +                 â”‚
â”‚                base64(payload),                         â”‚
â”‚                JWT_ADMIN_SECRET)                        â”‚
â”‚                                                          â”‚
â”‚  Verification:                                          â”‚
â”‚  1. Decode header & payload                            â”‚
â”‚  2. Verify signature using JWT_ADMIN_SECRET            â”‚
â”‚  3. Check expiration (exp timestamp)                   â”‚
â”‚  4. Check role for protected routes                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request/Response Cycle

```
REQUEST:
â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/v1/auth/login
Content-Type: application/json
Body:
{
  "adminId": "ADMIN001",
  "password": "Admin@123"
}
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Express App â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Route matching
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ authRoutes.ts  â”‚
    â”‚ POST /login    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Joi Validation         â”‚
    â”‚ (validateRequest)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ auth.controller.login()â”‚
    â”‚                        â”‚
    â”‚ 1. Check credentials   â”‚
    â”‚ 2. Find admin in DB    â”‚
    â”‚ 3. Compare password    â”‚
    â”‚ 4. Generate token      â”‚
    â”‚ 5. Update lastLogin    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
RESPONSE:  â–¼
â”€â”€â”€â”€â”€â”€â”€â”€
HTTP 200 OK
Content-Type: application/json
Body:
{
  "success": true,
  "message": "Login successful",
  "data": {
    "token": "eyJhbGciOi...",
    "admin": {
      "id": "507f...",
      "adminId": "ADMIN001",
      "name": "Admin User",
      "email": "admin@epasaley.com",
      "role": "super_admin"
    }
  }
}
```

## Protected Route Request/Response

```
REQUEST:
â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/v1/categories
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
Content-Type: application/json
Body:
{
  "name": "Electronics",
  "description": "Electronic devices"
}
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Express App â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Route matching
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ authenticate(true)     â”‚ â† Middleware
    â”‚ [Auth required, admin] â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Extract token from header
           â”‚ Verify JWT signature
           â”‚ Check expiration
           â”‚ Attach to req.user
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Token Valid         â”‚
    â”‚ Proceed to next()      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Joi Validation         â”‚
    â”‚ (validateRequest)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ categoryController     â”‚
    â”‚ .create()              â”‚
    â”‚                        â”‚
    â”‚ 1. Validate data       â”‚
    â”‚ 2. Check permissions   â”‚
    â”‚ 3. Upload image        â”‚
    â”‚ 4. Save to DB          â”‚
    â”‚ 5. Return response     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
RESPONSE:  â–¼
â”€â”€â”€â”€â”€â”€â”€â”€
HTTP 201 Created
Content-Type: application/json
Body:
{
  "success": true,
  "message": "Category created",
  "data": {
    "_id": "507f191e810c19729de860ea",
    "name": "Electronics",
    "slug": "electronics",
    "description": "Electronic devices",
    "createdAt": "2025-11-28T10:30:00Z"
  }
}
```

## Error Handling Flow

```
REQUEST with Bad/Missing Token
         â”‚
         â–¼
    authenticate() middleware
    â”œâ”€ No Authorization header?
    â”‚  â””â”€ throw UnauthorizedError("No token provided")
    â”‚
    â”œâ”€ Invalid format?
    â”‚  â””â”€ throw UnauthorizedError("Invalid token format")
    â”‚
    â”œâ”€ Token expired?
    â”‚  â””â”€ throw UnauthorizedError("Invalid or expired token")
    â”‚
    â”œâ”€ Signature invalid?
    â”‚  â””â”€ throw UnauthorizedError("Invalid or expired token")
    â”‚
    â””â”€ Admin role required but user?
       â””â”€ throw ForbiddenError("Admin access required")
           â”‚
           â–¼
    errorHandler middleware catches
           â”‚
           â–¼
    RESPONSE 401 or 403
    {
      "success": false,
      "message": "Error description",
      "error": "error_code"
    }
```

## Login Decision Tree

```
Admin Login Request
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate input?  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â”‚
    âœ…    âŒ "Admin ID and password required"
     â”‚     â””â”€â†’ Return 400
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Find admin by ID?â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â”‚
    âœ…    âŒ "Invalid admin ID or password"
     â”‚     â””â”€â†’ Return 401
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Is active?       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â”‚
    âœ…    âŒ "Admin account is inactive"
     â”‚     â””â”€â†’ Return 401
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Password match?  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â”‚
    âœ…    âŒ "Invalid admin ID or password"
     â”‚     â””â”€â†’ Return 401
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate token   â”‚
â”‚ Update lastLogin â”‚
â”‚ Return response  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
Return 200 OK
with token
```

---

**Status:** âœ… Complete Authentication System Architecture  
**Version:** 1.0  
**API Base:** `/api/v1/auth`
